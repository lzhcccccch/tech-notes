## 在 MySQL 中，如果要存储 IP 地址，用什么数据类型比较好？

[toc]

#### 简介

在 MySQL 中，存储 IP 地址的最佳数据类型取决于以下因素：IP 地址的版本（IPv4 或 IPv6）以及你对存储空间和查询性能的要求。

---

#### IPv4 地址
IPv4 地址是 32 位的数字（例如 `192.168.0.1`），可以用以下两种方式存储：

##### （1）`INT UNSIGNED` 类型
- **存储方式**：将 IPv4 地址转换为一个 32 位无符号整数（使用 MySQL 提供的函数 `INET_ATON()` 和 `INET_NTOA()`）。
  - `INET_ATON('192.168.0.1')` 会将 IP 地址转换为整数：`3232235521`。
  - `INET_NTOA(3232235521)` 会将整数转换回 IP 地址：`192.168.0.1`。
- **优点**：
  - 占用空间小（4 字节）。
  - 查询效率高（可以直接比较数值大小）。
- **缺点**：
  - 不直观，存储的值是整数，需要使用函数进行转换才能查看或操作。

##### （2）`VARCHAR(15)` 类型
- **存储方式**：直接以字符串形式存储 IP 地址，例如 `192.168.0.1`。
- **优点**：
  - 可读性强，存储的值直接是 IP 地址。
- **缺点**：
  - 占用空间较大（每个字符占 1 字节，最多需要 15 字节）。
  - 查询性能较差（字符串比较效率低，无法进行数值范围查询）。

##### 推荐方案
对于 IPv4 地址，建议使用 `INT UNSIGNED`，因为它占用空间小且性能更高。如果需要更直观的数据表示，可以在查询时使用 `INET_NTOA()` 函数转换。

---

#### IPv6 地址
IPv6 地址是 128 位的数字（例如 `2001:0db8:85a3:0000:0000:8a2e:0370:7334`），可以用以下两种方式存储：

##### （1）`BINARY(16)` 类型
- **存储方式**：将 IPv6 地址转换为 16 字节的二进制数据（使用 MySQL 提供的函数 `INET6_ATON()` 和 `INET6_NTOA()`）。
  - `INET6_ATON('2001:0db8:85a3:0000:0000:8a2e:0370:7334')` 会将 IP 地址转换为二进制数据。
  - `INET6_NTOA(二进制数据)` 会将二进制数据转换回 IP 地址。
- **优点**：
  - 占用空间固定（16 字节）。
  - 查询效率高。
- **缺点**：
  - 不直观，存储的值是二进制数据，需要使用函数进行转换。

##### （2）`VARCHAR(39)` 类型
- **存储方式**：直接以字符串形式存储 IPv6 地址，例如 `2001:0db8:85a3:0000:0000:8a2e:0370:7334`。
- **优点**：
  - 可读性强，存储的值直接是 IP 地址。
- **缺点**：
  - 占用空间较大（最多需要 39 字节）。
  - 查询性能较差。

##### 推荐方案
对于 IPv6 地址，建议使用 `BINARY(16)`，因为它占用空间固定且性能更高。如果需要更直观的数据表示，可以在查询时使用 `INET6_NTOA()` 函数转换。

---

#### 通用方案
如果需要同时存储 IPv4 和 IPv6 地址，可以使用以下方案：
- **`VARBINARY(16)`**：存储二进制格式的 IP 地址（IPv4 占用 4 字节，IPv6 占用 16 字节）。
- **`VARCHAR(39)`**：存储字符串形式的 IP 地址（IPv4 最多 15 字节，IPv6 最多 39 字节）。

但从性能和存储效率的角度来看，`VARBINARY(16)` 是更好的选择。

---

#### 总结
- **IPv4**：推荐使用 `INT UNSIGNED`。
- **IPv6**：推荐使用 `BINARY(16)`。
- **同时支持 IPv4 和 IPv6**：推荐使用 `VARBINARY(16)` 或 `BINARY(16)`。

此外，使用 MySQL 的内置函数（如 `INET_ATON()`、`INET_NTOA()`、`INET6_ATON()` 和 `INET6_NTOA()`）可以方便地在存储格式和可读格式之间进行转换。