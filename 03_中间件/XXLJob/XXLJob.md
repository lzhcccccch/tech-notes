## XXLJob

[toc]

#### 一、 简介





---

---

#### 二、 组成原理



---

---

#### 三、 注册、调度流程

执行器在使用 XxlJob 时，需要在配置文件中配置 **服务端（调度中心）地址adminAddress** ，配置该参数的目的是让执行器能够正常回调调度中心，因为执行器执行完毕是通过回调方法通知调度中心已经执行完毕，调度中心对任务的执行结果进行更新，以及调度中心获取执行器的日志也需要该参数的配置。



##### 1. 注册

执行器在启动时会读取配置文件，从而向调度中心进行服务注册，在执行器运行过程中，会每隔 30 秒向调度中心注册一次，从而保证调度中心中的任务是新的。

执行器在注册过程中会从上下文中获取所有加了 **@XxlJob** 注解的所有方法和类，将这些信息发送到调度中心。

调度中心会将这些信息保存到数据库中。

---

##### 2. 调度

调度中心在进行调度时，会将 5 秒后要执行的数据提前查出来，放入缓存（时间轮）中，存储结构为 Map<Integer, List<String>>，其中 key 0-59   value 任务 id。

调度中心在读数据库时会进行加锁，加行锁，用来保证任务只调度一次。但是前提是保证调度中心集群和数据库时间必须一致，否则无法保证（官方文档提及）。

在进行任务调度时，调度中心会记录任务一分钟内没执行完毕的次数，调度中心会分为快慢两个线程池进行任务调度，将超过一分钟没执行完的次数大于 10 次的任务放入慢线程池中。



